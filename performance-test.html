<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ€§èƒ½æµ‹è¯• - TKTextHighlight</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    .test-panel {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .test-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      background: #007bff;
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #0056b3;
    }
    button.secondary {
      background: #6c757d;
    }
    button.success {
      background: #28a745;
    }
    .results {
      background: white;
      padding: 15px;
      border-radius: 4px;
      margin-top: 15px;
    }
    .result-item {
      padding: 8px;
      margin: 5px 0;
      border-left: 4px solid #007bff;
      background: #f8f9fa;
    }
    .result-item.fast {
      border-color: #28a745;
      background: #d4edda;
    }
    .result-item.slow {
      border-color: #ffc107;
      background: #fff3cd;
    }
    .content-area {
      background: white;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-top: 20px;
      max-height: 400px;
      overflow-y: auto;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .stat-box {
      background: white;
      padding: 15px;
      border-radius: 4px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #007bff;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸš€ TKTextHighlight æ€§èƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•ä¼˜åŒ–åçš„é«˜äº®å™¨åœ¨ä¸åŒåœºæ™¯ä¸‹çš„æ€§èƒ½è¡¨ç°</p>
  </div>

  <div class="test-panel">
    <h2>æµ‹è¯•æ§åˆ¶</h2>
    <div class="test-controls">
      <button onclick="generateSmallDoc()">ç”Ÿæˆå°æ–‡æ¡£ï¼ˆ100æ®µï¼‰</button>
      <button onclick="generateMediumDoc()">ç”Ÿæˆä¸­ç­‰æ–‡æ¡£ï¼ˆ500æ®µï¼‰</button>
      <button onclick="generateLargeDoc()">ç”Ÿæˆå¤§æ–‡æ¡£ï¼ˆ2000æ®µï¼‰</button>
      <button class="secondary" onclick="runPerformanceTest()">è¿è¡Œæ€§èƒ½æµ‹è¯•</button>
      <button class="success" onclick="clearContent()">æ¸…ç©ºå†…å®¹</button>
    </div>

    <div class="stats">
      <div class="stat-box">
        <div class="stat-value" id="nodeCount">0</div>
        <div class="stat-label">æ–‡æœ¬èŠ‚ç‚¹æ•°</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="charCount">0</div>
        <div class="stat-label">å­—ç¬¦æ€»æ•°</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="matchCount">0</div>
        <div class="stat-label">åŒ¹é…æ•°é‡</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="avgTime">-</div>
        <div class="stat-label">å¹³å‡è€—æ—¶ï¼ˆmsï¼‰</div>
      </div>
    </div>

    <div class="results" id="results" style="display: none;">
      <h3>æµ‹è¯•ç»“æœ</h3>
      <div id="resultsList"></div>
    </div>
  </div>

  <div class="content-area" id="content">
    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆæµ‹è¯•æ–‡æ¡£...</p>
  </div>

  <script src="dist/tk-text-highlight.js"></script>
  <script>
    const highlighter = new TKTextHighlight(document.getElementById('content'));
    const testWord = 'JavaScript';

    function generateSmallDoc() {
      generateDocument(100);
    }

    function generateMediumDoc() {
      generateDocument(500);
    }

    function generateLargeDoc() {
      generateDocument(2000);
    }

    function generateDocument(paragraphs) {
      const content = document.getElementById('content');
      content.innerHTML = '<h2>æµ‹è¯•æ–‡æ¡£</h2>';
      
      const texts = [
        `${testWord} æ˜¯ä¸€ç§é«˜çº§çš„ã€è§£é‡Šå‹çš„ç¼–ç¨‹è¯­è¨€ã€‚`,
        `${testWord} æœ€åˆè¢«è®¾è®¡ä¸ºæµè§ˆå™¨è„šæœ¬è¯­è¨€ã€‚`,
        `ç°åœ¨ï¼Œ${testWord} ä¸ä»…å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚`,
        `ä½¿ç”¨ ${testWord}ï¼Œä½ å¯ä»¥åˆ›å»ºäº¤äº’å¼çš„ç½‘é¡µåº”ç”¨ã€‚`,
        `${testWord} é€šè¿‡ Node.js ä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œã€‚`,
        `${testWord} æ˜¯ä¸€é—¨å¤šèŒƒå¼çš„è¯­è¨€ï¼Œæ”¯æŒé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ã€‚`,
        `æµè§ˆå™¨ä¸­åµŒå…¥äº† ${testWord} å¼•æ“ï¼Œæœ‰æ—¶ä¹Ÿç§°ä½œè™šæ‹Ÿæœºã€‚`,
        `${testWord} å·²ç»æˆä¸ºäº†ä¸€é—¨é€šç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚`
      ];

      const fragment = document.createDocumentFragment();
      
      for (let i = 0; i < paragraphs; i++) {
        const p = document.createElement('p');
        p.textContent = texts[i % texts.length] + ` (æ®µè½ ${i + 1})`;
        fragment.appendChild(p);
      }

      content.appendChild(fragment);
      
      // æ›´æ–°ç»Ÿè®¡
      updateStats();
    }

    function updateStats() {
      // è®¡ç®—æ–‡æœ¬èŠ‚ç‚¹æ•°
      const walker = document.createTreeWalker(
        document.getElementById('content'),
        NodeFilter.SHOW_TEXT,
        null
      );
      let nodeCount = 0;
      let charCount = 0;
      while (walker.nextNode()) {
        nodeCount++;
        charCount += (walker.currentNode.textContent || '').length;
      }

      document.getElementById('nodeCount').textContent = nodeCount;
      document.getElementById('charCount').textContent = charCount.toLocaleString();

      // è®¡ç®—åŒ¹é…æ•°
      const matchCount = highlighter.countMatches(testWord);
      document.getElementById('matchCount').textContent = matchCount;
    }

    function runPerformanceTest() {
      const resultsList = document.getElementById('resultsList');
      resultsList.innerHTML = '';
      
      const results = document.getElementById('results');
      results.style.display = 'block';

      const matchCount = highlighter.countMatches(testWord);
      
      if (matchCount === 0) {
        resultsList.innerHTML = '<div class="result-item">è¯·å…ˆç”Ÿæˆæµ‹è¯•æ–‡æ¡£</div>';
        return;
      }

      const testCases = [
        { index: 0, label: 'ç¬¬1ä¸ªåŒ¹é…' },
        { index: Math.floor(matchCount / 2), label: `ç¬¬${Math.floor(matchCount / 2) + 1}ä¸ªåŒ¹é…ï¼ˆä¸­é—´ï¼‰` },
        { index: matchCount - 1, label: `ç¬¬${matchCount}ä¸ªåŒ¹é…ï¼ˆæœ€åï¼‰` }
      ];

      const times = [];

      testCases.forEach(testCase => {
        if (testCase.index >= matchCount) return;

        // é¢„çƒ­
        highlighter.highlight(testWord, testCase.index);
        highlighter.clearHighlight();

        // æ­£å¼æµ‹è¯•ï¼ˆå¤šæ¬¡å–å¹³å‡ï¼‰
        const iterations = 10;
        let totalTime = 0;

        for (let i = 0; i < iterations; i++) {
          const start = performance.now();
          highlighter.highlight(testWord, testCase.index);
          const end = performance.now();
          totalTime += (end - start);
          highlighter.clearHighlight();
        }

        const avgTime = totalTime / iterations;
        times.push(avgTime);

        const item = document.createElement('div');
        item.className = 'result-item';
        
        if (avgTime < 1) {
          item.className += ' fast';
        } else if (avgTime > 10) {
          item.className += ' slow';
        }

        item.innerHTML = `
          <strong>${testCase.label}</strong>: 
          <span style="color: #007bff; font-weight: bold;">${avgTime.toFixed(3)}ms</span>
          ï¼ˆ${iterations}æ¬¡å¹³å‡ï¼‰
          ${avgTime < 1 ? ' âš¡ æå¿«' : avgTime < 5 ? ' âœ… å¿«é€Ÿ' : avgTime < 10 ? ' âš ï¸ ä¸€èˆ¬' : ' ğŸŒ è¾ƒæ…¢'}
        `;
        resultsList.appendChild(item);
      });

      // ç¼“å­˜å‘½ä¸­æµ‹è¯•
      const cacheStart = performance.now();
      highlighter.countMatches(testWord);
      const cacheEnd = performance.now();
      const cacheTime = cacheEnd - cacheStart;

      const cacheItem = document.createElement('div');
      cacheItem.className = 'result-item fast';
      cacheItem.innerHTML = `
        <strong>ç¼“å­˜æ€§èƒ½æµ‹è¯•ï¼ˆcountMatchesï¼‰</strong>: 
        <span style="color: #28a745; font-weight: bold;">${cacheTime.toFixed(3)}ms</span>
        ${cacheTime < 1 ? ' âš¡ ç¼“å­˜å‘½ä¸­ï¼Œæå¿«ï¼' : ' âœ… å¿«é€Ÿ'}
      `;
      resultsList.appendChild(cacheItem);

      // æ›´æ–°å¹³å‡æ—¶é—´
      const avgTime = times.reduce((a, b) => a + b, 0) / times.length;
      document.getElementById('avgTime').textContent = avgTime.toFixed(2);

      // æ€§èƒ½è¯„ä¼°
      const summary = document.createElement('div');
      summary.className = 'result-item';
      summary.style.background = '#e7f3ff';
      summary.style.borderColor = '#0066cc';
      summary.innerHTML = `
        <strong>ğŸ“Š æ€§èƒ½æ€»ç»“</strong><br>
        æ–‡æ¡£è§„æ¨¡: ${document.getElementById('nodeCount').textContent} ä¸ªæ–‡æœ¬èŠ‚ç‚¹<br>
        å¹³å‡æŸ¥æ‰¾æ—¶é—´: ${avgTime.toFixed(3)}ms<br>
        æ€§èƒ½è¯„çº§: ${avgTime < 1 ? 'â­â­â­â­â­ ä¼˜ç§€' : avgTime < 5 ? 'â­â­â­â­ è‰¯å¥½' : avgTime < 10 ? 'â­â­â­ ä¸€èˆ¬' : 'â­â­ éœ€ä¼˜åŒ–'}
      `;
      resultsList.appendChild(summary);
    }

    function clearContent() {
      document.getElementById('content').innerHTML = '<p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ç”Ÿæˆæµ‹è¯•æ–‡æ¡£...</p>';
      document.getElementById('results').style.display = 'none';
      document.getElementById('nodeCount').textContent = '0';
      document.getElementById('charCount').textContent = '0';
      document.getElementById('matchCount').textContent = '0';
      document.getElementById('avgTime').textContent = '-';
      highlighter.clearHighlight();
    }
  </script>
</body>
</html>

