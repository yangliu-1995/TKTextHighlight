# TKTextHighlight

ä¸€ä¸ª**é«˜æ€§èƒ½**çš„æ–‡æœ¬é«˜äº®åº“ï¼Œæ”¯æŒé«˜äº®æŒ‡å®šæ–‡æœ¬å¹¶åœ¨é«˜äº®èŒƒå›´å†…è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¯ **ç²¾ç¡®é«˜äº®**ï¼šé«˜äº®é¡µé¢ä¸­ç¬¬ N ä¸ªåŒ¹é…çš„æ–‡æœ¬
- âœ¨ **äºŒæ¬¡æ ‡è®°**ï¼šåœ¨é«˜äº®èŒƒå›´å†…æ ‡è®°ç‰¹å®šåŒºåŸŸ
- ğŸ§¹ **è‡ªåŠ¨æ¸…ç†**ï¼šå¤šæ¬¡è°ƒç”¨æ—¶è‡ªåŠ¨æ¸…é™¤ä¹‹å‰çš„é«˜äº®å’Œæ ‡è®°
- ğŸ“¦ **é›¶ä¾èµ–**ï¼šçº¯ TypeScript å®ç°ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–
- ğŸ¨ **å¯è‡ªå®šä¹‰æ ·å¼**ï¼šé€šè¿‡ CSS ç±»è‡ªå®šä¹‰é«˜äº®å’Œæ ‡è®°æ ·å¼
- ğŸš€ **é«˜æ€§èƒ½ä¼˜åŒ–**ï¼š
  - æ™ºèƒ½ç¼“å­˜æœºåˆ¶ï¼ˆé¿å…é‡å¤éå† DOMï¼‰
  - æå‰é€€å‡ºç­–ç•¥ï¼ˆæ‰¾åˆ°ç›®æ ‡ç«‹å³è¿”å›ï¼‰
  - DocumentFragment æ‰¹é‡æ“ä½œï¼ˆå‡å°‘é‡ç»˜ï¼‰
  - MutationObserver è‡ªåŠ¨å¤±æ•ˆç¼“å­˜
  - å¯¹äºå¤§å‹æ–‡æ¡£ï¼ˆ1000+ èŠ‚ç‚¹ï¼‰ï¼Œæ€§èƒ½æå‡ **10-100 å€**

## æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æé€Ÿ |
|------|--------|--------|------|
| å°æ–‡æ¡£ï¼ˆ100 èŠ‚ç‚¹ï¼‰ï¼ŒæŸ¥æ‰¾ç¬¬ 1 ä¸ª | ~2ms | ~0.5ms | **4x** |
| ä¸­ç­‰æ–‡æ¡£ï¼ˆ1000 èŠ‚ç‚¹ï¼‰ï¼ŒæŸ¥æ‰¾ç¬¬ 1 ä¸ª | ~20ms | ~1ms | **20x** |
| å¤§æ–‡æ¡£ï¼ˆ10000 èŠ‚ç‚¹ï¼‰ï¼ŒæŸ¥æ‰¾ç¬¬ 1 ä¸ª | ~200ms | ~2ms | **100x** |

è¯¦ç»†æ€§èƒ½è¯´æ˜è¯·æŸ¥çœ‹ [PERFORMANCE.md](./PERFORMANCE.md)

## å®‰è£…

```bash
npm install
```

## æ„å»º

```bash
# ç”Ÿäº§ç¯å¢ƒæ„å»º
npm run build

# å¼€å‘ç¯å¢ƒæ„å»ºï¼ˆå¸¦ç›‘å¬ï¼‰
npm run dev
```

æ„å»ºåä¼šåœ¨ `dist` ç›®å½•ç”Ÿæˆ `tk-text-highlight.js` æ–‡ä»¶ã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. å¼•å…¥åº“

```html
<script src="dist/tk-text-highlight.js"></script>
```

### 2. åˆ›å»ºå®ä¾‹

```javascript
// åœ¨æ•´ä¸ªé¡µé¢ä¸­æœç´¢
const highlighter = new TKTextHighlight();

// æˆ–è€…æŒ‡å®šæœç´¢èŒƒå›´
const container = document.getElementById('content');
const highlighter = new TKTextHighlight(container);
```

### 3. é«˜äº®æ–‡æœ¬

```javascript
// é«˜äº®ç¬¬ä¸€ä¸ªåŒ¹é…çš„ "JavaScript"
highlighter.highlight('JavaScript', 0);

// é«˜äº®ç¬¬äºŒä¸ªåŒ¹é…çš„ "JavaScript"
highlighter.highlight('JavaScript', 1);
```

### 4. æ ‡è®°èŒƒå›´

```javascript
// åœ¨å½“å‰é«˜äº®æ–‡æœ¬ä¸­ï¼Œä»ç¬¬0ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæ ‡è®°4ä¸ªå­—ç¬¦
highlighter.mark({ start: 0, length: 4 });
```

### 5. æ¸…é™¤é«˜äº®

```javascript
// æ¸…é™¤æ‰€æœ‰é«˜äº®å’Œæ ‡è®°
highlighter.clearHighlight();

// åªæ¸…é™¤æ ‡è®°ï¼Œä¿ç•™é«˜äº®
highlighter.clearMarks();
```

## API æ–‡æ¡£

### æ„é€ å‡½æ•°

```typescript
new TKTextHighlight(rootElement?: HTMLElement)
```

- `rootElement`: å¯é€‰ï¼ŒæŒ‡å®šæœç´¢èŒƒå›´çš„æ ¹å…ƒç´ ï¼Œé»˜è®¤ä¸º `document.body`

### æ–¹æ³•

#### highlight(text: string, index: number): boolean

é«˜äº®é¡µé¢ä¸­ç¬¬ index ä¸ªåŒ¹é…çš„æ–‡æœ¬ã€‚

- `text`: è¦é«˜äº®çš„æ–‡æœ¬
- `index`: åŒ¹é…ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼‰
- è¿”å›: æ˜¯å¦æˆåŠŸé«˜äº®

**æ³¨æ„**ï¼šå¤šæ¬¡è°ƒç”¨ä¼šè‡ªåŠ¨æ¸…é™¤ä¹‹å‰çš„é«˜äº®ã€‚

#### mark(range: HighlightRange): boolean

åœ¨å½“å‰é«˜äº®èŒƒå›´å†…æ ‡è®°æŒ‡å®šåŒºåŸŸã€‚

- `range`: æ ‡è®°èŒƒå›´å¯¹è±¡ `{ start: number, length: number }`
  - `start`: åœ¨é«˜äº®æ–‡æœ¬ä¸­çš„èµ·å§‹ä½ç½®ï¼ˆä» 0 å¼€å§‹ï¼‰
  - `length`: æ ‡è®°é•¿åº¦
- è¿”å›: æ˜¯å¦æˆåŠŸæ ‡è®°

**æ³¨æ„**ï¼š
- å¿…é¡»å…ˆè°ƒç”¨ `highlight()` æ‰èƒ½ä½¿ç”¨ `mark()`
- å¤šæ¬¡è°ƒç”¨ä¼šè‡ªåŠ¨æ¸…é™¤ä¹‹å‰çš„æ ‡è®°

#### clearHighlight(): void

æ¸…é™¤å½“å‰çš„é«˜äº®å’Œæ‰€æœ‰æ ‡è®°ã€‚

#### clearMarks(): void

åªæ¸…é™¤æ ‡è®°ï¼Œä¿ç•™é«˜äº®ã€‚

#### setRootElement(element: HTMLElement): void

è®¾ç½®æ–°çš„æœç´¢èŒƒå›´æ ¹å…ƒç´ ã€‚

#### getCurrentHighlight(): HighlightResult | null

è·å–å½“å‰é«˜äº®ä¿¡æ¯ã€‚

#### countMatches(searchText: string): number

è·å–æŒ‡å®šæ–‡æœ¬åœ¨é¡µé¢ä¸­çš„åŒ¹é…æ•°é‡ã€‚

- `searchText`: è¦æœç´¢çš„æ–‡æœ¬
- è¿”å›: åŒ¹é…çš„æ€»æ•°

**ç”¨é€”**ï¼šæ˜¾ç¤º"å…±æ‰¾åˆ° X ä¸ªç»“æœ"

#### refreshCache(): void

æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜ã€‚åœ¨å·²çŸ¥ DOM å‘ç”Ÿå¤§é‡å˜åŒ–æ—¶ï¼Œå¯ä»¥è°ƒç”¨æ­¤æ–¹æ³•æ‰‹åŠ¨åˆ·æ–°ç¼“å­˜ã€‚

**æ³¨æ„**ï¼šé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼ŒMutationObserver ä¼šè‡ªåŠ¨å¤„ç†ã€‚

## è‡ªå®šä¹‰æ ·å¼

å¯ä»¥é€šè¿‡è¦†ç›–ä»¥ä¸‹ CSS ç±»æ¥è‡ªå®šä¹‰æ ·å¼ï¼š

```css
/* é«˜äº®æ ·å¼ */
.tk-highlight {
  background-color: #ffeb3b;  /* é»„è‰²èƒŒæ™¯ */
  transition: background-color 0.2s ease;
}

/* æ ‡è®°æ ·å¼ */
.tk-highlight-mark {
  background-color: #ff9800;  /* æ©™è‰²èƒŒæ™¯ */
  font-weight: bold;
}
```

## ç¤ºä¾‹

æŸ¥çœ‹ `example.html` æ–‡ä»¶ä»¥è·å–å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ã€‚

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `example.html` å³å¯çœ‹åˆ°äº¤äº’å¼æ¼”ç¤ºã€‚

## æŠ€æœ¯æ ˆ

- TypeScript
- Webpack
- CSS

## License

MIT

